{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "5bd9a922-e882-44c1-8949-26cc24946e6a",
            "version": "KqlParameterItem/1.0",
            "name": "EntityType",
            "type": 2,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    { \"value\":\"ip\", \"label\":\"Private IP Address\" },\r\n    { \"value\":\"publicip\", \"label\":\"Public IP Address\" },\r\n    { \"value\":\"host\", \"label\":\"Hostname\" },\r\n    { \"value\":\"aduser\", \"label\":\"AD User\" },\r\n    { \"value\":\"user\", \"label\":\"Email Account\", \"selected\":true }\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "ip"
          },
          {
            "id": "c7443067-b1f9-4f4d-aa89-c4cd27ed5c0f",
            "version": "KqlParameterItem/1.0",
            "name": "Variable",
            "type": 1,
            "isRequired": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "value": ""
          },
          {
            "id": "90a2a2a2-729f-4016-9f4e-4f3df925429f",
            "version": "KqlParameterItem/1.0",
            "name": "Timerange",
            "label": "",
            "type": 4,
            "description": "1d, 30m, etc",
            "isRequired": true,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "value": {
              "durationMs": 86400000
            }
          },
          {
            "id": "73a0398e-cf7c-497a-83cb-76dff4c413de",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "label": "Client",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources | where type =~ 'Microsoft.operationsmanagement/solutions' | where name contains 'SecurityInsights' | project id = tostring(properties.workspaceResourceId)\r\n",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ]
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "/subscriptions/193adb00-3bae-469e-b548-830a894810a0/resourcegroups/Quzara-monitoring/providers/Microsoft.OperationalInsights/workspaces/Quzara-Corporate"
            ]
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 0"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAlert\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| search @'{Variable}'\r\n| project AlertTime = TimeGenerated, \r\n          AlertName = DisplayName, \r\n          AlertDescription = Description\r\n| order by AlertTime desc",
        "size": 1,
        "showAnalytics": true,
        "title": "SecurityAlert Involving Entity",
        "timeContextFromParameter": "Timerange",
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "rowLimit": 50
        },
        "tileSettings": {
          "titleContent": {
            "columnMatch": "AlertName",
            "formatter": 1
          },
          "subtitleContent": {
            "columnMatch": "AlertTime",
            "formatter": 6
          },
          "showBorder": false,
          "sortCriteriaField": "AlertTime",
          "sortOrderField": 2,
          "size": "full"
        },
        "graphSettings": {
          "type": 0
        },
        "chartSettings": {
          "xAxis": "TimeGenerated",
          "showLegend": true,
          "xSettings": {
            "label": "Time"
          },
          "ySettings": {
            "label": "Alerts"
          }
        }
      },
      "customWidth": "40",
      "showPin": true,
      "name": "SecurityAlert Involving Entity",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAlert\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| search @\"{Variable}\"\r\n| summarize count() by ProviderName",
        "size": 1,
        "showAnalytics": true,
        "title": "Security Alert Product Information",
        "timeContextFromParameter": "Timerange",
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "piechart",
        "gridSettings": {
          "rowLimit": 50,
          "filter": true
        },
        "tileSettings": {
          "titleContent": {
            "columnMatch": "AlertName",
            "formatter": 1
          },
          "subtitleContent": {
            "columnMatch": "AlertTime",
            "formatter": 6
          },
          "showBorder": false,
          "sortCriteriaField": "AlertTime",
          "sortOrderField": 2,
          "size": "full"
        },
        "graphSettings": {
          "type": 0
        },
        "chartSettings": {
          "xAxis": "TimeGenerated",
          "showLegend": true,
          "xSettings": {
            "label": "Time"
          },
          "ySettings": {
            "label": "Alerts"
          }
        }
      },
      "customWidth": "30",
      "showPin": true,
      "name": "Security Alert Product Information",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAlert\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| search @\"{Variable}\"\r\n| summarize count() by Status",
        "size": 1,
        "showAnalytics": true,
        "title": "Security Alert Status",
        "timeContextFromParameter": "Timerange",
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "piechart",
        "gridSettings": {
          "rowLimit": 50,
          "filter": true
        },
        "tileSettings": {
          "titleContent": {
            "columnMatch": "AlertName",
            "formatter": 1
          },
          "subtitleContent": {
            "columnMatch": "AlertTime",
            "formatter": 6
          },
          "showBorder": false,
          "sortCriteriaField": "AlertTime",
          "sortOrderField": 2,
          "size": "full"
        },
        "graphSettings": {
          "type": 0
        },
        "chartSettings": {
          "xAxis": "TimeGenerated",
          "showLegend": true,
          "xSettings": {
            "label": "Time"
          },
          "ySettings": {
            "label": "Alerts"
          }
        }
      },
      "customWidth": "30",
      "showPin": true,
      "name": "Security Alert Status",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Email Triage",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "IdentityInfo\r\n| where TimeGenerated >= ago (30d)\r\n| where AccountUPN =~ \"{Variable}\"\r\n| take 1\r\n| extend Location = strcat(\r\n    iff(isempty(StreetAddress), '', strcat(StreetAddress, ', ')), \r\n    iff(isempty(City), '', strcat(City, ', ')), \r\n    iff(isempty(State), '', strcat(State)) \r\n)\r\n| project AccountDisplayName, AccountCreationTime, Department, JobTitle, Location, Phone, Enabled = IsAccountEnabled\r\n",
              "size": 3,
              "showAnalytics": true,
              "title": "Identity Info via UPN",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Identity Info via UPN"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where UserPrincipalName =~ '{Variable}'\r\n| extend city_  = tostring(LocationDetails.city) \r\n| extend state_ = tostring(LocationDetails.state) \r\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion) \r\n| extend latitude_  = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).latitude) \r\n| extend longitude_ = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).longitude) \r\n\r\n",
              "size": 3,
              "title": "IP Sign on Locations to Map",
              "timeContextFromParameter": "Timerange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "map",
              "mapSettings": {
                "locInfo": "LatLong",
                "latitude": "latitude_",
                "longitude": "longitude_",
                "sizeSettings": "IPAddress",
                "sizeAggregation": "Count",
                "labelSettings": "IPAddress",
                "legendMetric": "IPAddress",
                "legendAggregation": "Count",
                "itemColorSettings": {
                  "nodeColorField": "IPAddress",
                  "colorAggregation": "Count",
                  "type": "heatmap",
                  "heatmapPalette": "hotCold"
                }
              }
            },
            "customWidth": "60",
            "name": "IP Sign on Locations to Map"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where UserPrincipalName =~ '{Variable}'\r\n| extend authenticationMethod_ = tostring(parse_json(AuthenticationDetails)[0].authenticationMethod)\r\n| extend authenticationStepResultDetail_ = tostring(parse_json(AuthenticationDetails)[0].authenticationStepResultDetail)\r\n| extend succeeded_ = tostring(parse_json(AuthenticationDetails)[0].succeeded)\r\n| extend DeviceName = tostring(DeviceDetail.displayName)\r\n| extend DeviceTrustType = tostring(DeviceDetail.trustType)\r\n| extend operatingSystem_ = tostring(DeviceDetail.operatingSystem)\r\n| extend city_ = tostring(LocationDetails.city)\r\n| extend state_ = tostring(LocationDetails.state)\r\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion)\r\n| extend fullLocation = strcat(\r\n    iff(isempty(city_), '', strcat(city_, ', ')), \r\n    iff(isempty(state_), '', strcat(state_, ', ')), \r\n    countryOrRegion_\r\n)\r\n| where succeeded_ == \"true\"\r\n| summarize count() by fullLocation, IPAddress\r\n| order by count_\r\n",
              "size": 2,
              "showAnalytics": true,
              "title": "Summarize signin locations for user",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "35",
            "name": "Summarize signin locations for user",
            "styleSettings": {
              "maxWidth": "35"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| extend DeviceName = tostring(DeviceDetail.displayName)\r\n| where UserPrincipalName =~ '{Variable}' and DeviceName != \"\"\r\n| extend DeviceOS = tostring(DeviceDetail.operatingSystem)\r\n| project TimeGenerated, DeviceName, DeviceOS, AppDisplayName, IPAddress, RiskState\r\n| order by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Hosts a user has signed into",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "DeviceOS",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "DeviceOS",
                  "sortOrder": 1
                }
              ]
            },
            "name": "Hosts a user has signed into"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where UserPrincipalName =~ '{Variable}'\r\n| extend succeeded = tostring(parse_json(AuthenticationDetails)[0].succeeded)\r\n| summarize EventCount = count() by ResultType, bin(TimeGenerated, 1m)\r\n\r\n",
              "size": 1,
              "title": "SignInLog Result Trend",
              "timeContextFromParameter": "Timerange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "unstackedbar",
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "ResultType",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "EventCount",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "group": "ResultType",
                "createOtherGroup": null,
                "showLegend": true,
                "xSettings": {
                  "label": "Time"
                },
                "ySettings": {
                  "label": "Count"
                }
              }
            },
            "name": "SignInLog Result Trend"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where UserPrincipalName =~ '{Variable}'\r\n| extend authenticationMethod_ = tostring(parse_json(AuthenticationDetails)[0].authenticationMethod)\r\n| extend authenticationStepResultDetail_ = tostring(parse_json(AuthenticationDetails)[0].authenticationStepResultDetail)\r\n| extend succeeded_ = tostring(parse_json(AuthenticationDetails)[0].succeeded)\r\n| where (ResultType in (\"0\", \"Success\")) or (succeeded_ == \"true\")\r\n| extend DeviceName = tostring(DeviceDetail.displayName)\r\n| extend DeviceTrustType = tostring(DeviceDetail.trustType)\r\n| extend operatingSystem_ = tostring(DeviceDetail.operatingSystem)\r\n| extend city_ = tostring(LocationDetails.city)\r\n| extend state_ = tostring(LocationDetails.state)\r\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion)\r\n| extend fullLocation = strcat(\r\n    iff(isempty(city_), '', strcat(city_, ', ')), \r\n    iff(isempty(state_), '', strcat(state_, ', ')), \r\n    countryOrRegion_\r\n)\r\n| project TimeGenerated, IPAddress, ResultDescription, SourceSystem, AppDisplayName, authenticationMethod_, authenticationStepResultDetail_, succeeded_, ConditionalAccessStatus, DeviceName, DeviceTrustType, operatingSystem_, fullLocation, UserAgent, UserType\r\n| order by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Successful SignInLogs Activity",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Successful SignInLogs Activity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where UserPrincipalName =~'{Variable}'\r\n| extend authenticationMethod_ = tostring(parse_json(AuthenticationDetails)[0].authenticationMethod)\r\n| extend authenticationStepResultDetail_ = tostring(parse_json(AuthenticationDetails)[0].authenticationStepResultDetail)\r\n| extend succeeded_ = tostring(parse_json(AuthenticationDetails)[0].succeeded)\r\n| extend DeviceName = tostring(DeviceDetail.displayName)\r\n| extend DeviceTrustType = tostring(DeviceDetail.trustType)\r\n| extend operatingSystem_ = tostring(DeviceDetail.operatingSystem)\r\n| extend city_ = tostring(LocationDetails.city)\r\n| extend state_ = tostring(LocationDetails.state)\r\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion)\r\n| extend fullLocation = strcat(\r\n    iff(isempty(city_), '', strcat(city_, ', ')), \r\n    iff(isempty(state_), '', strcat(state_, ', ')), \r\n    countryOrRegion_\r\n)\r\n| where succeeded_ == \"false\"\r\n| project TimeGenerated, IPAddress, ResultDescription, SourceSystem, AppDisplayName, authenticationMethod_, authenticationStepResultDetail_, succeeded_, ConditionalAccessStatus, DeviceName, DeviceTrustType, operatingSystem_, fullLocation, UserAgent, UserType\r\n| order by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Failed SignInLogs Activity",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "Failed SignInLogs Activity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let searchvalue = \"{Variable}\";\r\nBehaviorAnalytics\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where isnotempty(searchvalue)\r\n| where UserName contains_cs \"{Variable}\"\r\n| summarize count() by ActionType",
              "size": 1,
              "showAnalytics": true,
              "title": "BehaviorAnalytics User Info",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "gridSettings": {
                "filter": true
              }
            },
            "name": "BehaviorAnalytics User Info"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "EmailEvents\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where RecipientEmailAddress =~ '{Variable}'\r\n| project TimeGenerated, SenderFromAddress, Subject, AttachmentCount, UrlCount, DeliveryAction, EmailDirection, EmailLanguage\r\n| order by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Received Emails",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "Received Emails"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "EmailEvents\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where SenderFromAddress=~ '{Variable}'\r\n| project TimeGenerated, RecipientEmailAddress, Subject, AttachmentCount, UrlCount, DeliveryAction, EmailDirection, EmailLanguage\r\n| order by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Sent Emails",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "Sent Emails"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "EmailAttachmentInfo\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where SenderFromAddress =~ '{Variable}' or RecipientEmailAddress =~ '{Variable}'\r\n| project TimeGenerated, FileName, FileType, RecipientEmailAddress, SenderFromAddress, SHA256, FileSize\r\n| order by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Attachment Info in emails",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "Attachment Info in emails"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "EmailUrlInfo\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| join kind=inner (\r\n    EmailEvents\r\n    | project SenderFromAddress, RecipientEmailAddress, NetworkMessageId\r\n) on NetworkMessageId\r\n| where SenderFromAddress =~ '{Variable}' or RecipientEmailAddress =~ '{Variable}'\r\n| project TimeGenerated, Url, UrlLocation, Domain = UrlDomain, Sender = SenderFromAddress, Recipient = RecipientEmailAddress\r\n| order by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "URL Info in emails",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "URL Info in emails"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AuditLogs\r\n| where OperationName has \"Reset\"\r\n| extend ipAddress = tostring(parse_json(tostring(InitiatedBy.user)).ipAddress)\r\n| extend Account = tostring(TargetResources[0].displayName), \r\n          InitiatingUser = tostring(InitiatedBy.user.userPrincipalName)\r\n| where InitiatingUser =~ '{Variable}' or Account =~ '{Variable}'\r\n| project TimeGenerated, Account, InitiatingUser, ResultDescription, ActivityDateTime, Location, ipAddress\r\n| sort by TimeGenerated desc\r\n",
              "size": 4,
              "showAnalytics": true,
              "title": "AzureAD Password Resets",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "AzureAD Password Resets"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "EntityType",
        "comparison": "isEqualTo",
        "value": "user"
      },
      "name": "Email Triage",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Host Triage",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Heartbeat\r\n| where Computer == \"{Variable}\" or ComputerIP == \"{Variable}\" or ComputerPrivateIPs contains \"{Variable}\"\r\n| project TimeGenerated, Computer, ComputerIP, OSType, OSName, RemoteIPCountry, ComputerPrivateIPs, ComputerEnvironment\r\n| take 1",
              "size": 3,
              "showAnalytics": true,
              "title": "Heartbeat Host Details",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "rowLimit": 1
              },
              "tileSettings": {
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              }
            },
            "name": "Heartbeat Host Details"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let searchvalue = \"{Variable}\";\r\nDeviceNetworkEvents\r\n| where DeviceName has '{Variable}'\r\n| extend User = InitiatingProcessAccountUpn,\r\n        File = InitiatingProcessFileName,\r\n        ParentFile = InitiatingProcessParentFileName,\r\n        Product = InitiatingProcessVersionInfoProductName,\r\n        URL = RemoteUrl\r\n| project TimeGenerated, DeviceName, LocalIP, LocalPort, RemoteIP, RemotePort, User, File, ParentFile, Product, URL\r\n| order by TimeGenerated desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Recent Device Network Activity",
              "timeContextFromParameter": "Timerange",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "rowLimit": 10000,
                "filter": true
              }
            },
            "name": "Recent Device Network Activity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Syslog\r\n| where Computer has '{Variable}'\r\n| extend \r\n    SerialNumber = iff(SyslogMessage !contains \"Fortigate\", \r\n                       extract(\"sn=([\\\\w\\\\d]+)\", 1, SyslogMessage), \r\n                       extract(\"deviceExternalId=([^ ]+)\", 1, SyslogMessage)),\r\n    Firewall = iff(SyslogMessage !contains \"Fortigate\", \r\n                   extract(\"fw=([\\\\d\\\\.]+)\", 1, SyslogMessage), \r\n                   \"Fortinet\"), // Assuming 'Firewall' refers to the brand\r\n    Priority = iff(SyslogMessage !contains \"Fortigate\", \r\n                   extract(\"pri=(\\\\d+)\", 1, SyslogMessage), \r\n                   extract(\"FTNTFGTlevel=([^ ]+)\", 1, SyslogMessage)),\r\n    Message = iff(SyslogMessage !contains \"Fortigate\", \r\n                  extract('msg=\\\"([^\\\"]+)\\\"', 1, SyslogMessage), \r\n                  extract(\"msg=([^ ]+)\", 1, SyslogMessage)),\r\n    SrcMac = iff(SyslogMessage !contains \"Fortigate\", \r\n                 extract(\"srcMac=([\\\\w\\\\d:]+)\", 1, SyslogMessage), \r\n                 \"\"), // Placeholder as MAC isn't directly in Fortinet log\r\n    SrcIP = iff(SyslogMessage !contains \"Fortigate\", \r\n                extract(\"src=([\\\\d\\\\.]+):\", 1, SyslogMessage), \r\n                extract(\"src=([^ ]+)\", 1, SyslogMessage)),\r\n    SrcPort = iff(SyslogMessage !contains \"Fortigate\", \r\n                  extract(\"src=[\\\\d\\\\.]+:(\\\\d+)\", 1, SyslogMessage), \r\n                  extract(\"spt=([^ ]+)\", 1, SyslogMessage)),\r\n    NatSrc = iff(SyslogMessage !contains \"Fortigate\", \r\n                 extract(\"natSrc=([\\\\d\\\\.]+)\", 1, SyslogMessage), \r\n                 \"\"), // Placeholder as NAT source isn't directly in Fortinet log\r\n    DstMac = iff(SyslogMessage !contains \"Fortigate\", \r\n                 extract(\"dstMac=([\\\\w\\\\d:]+)\", 1, SyslogMessage), \r\n                 \"\"), // Placeholder as MAC isn't directly in Fortinet log\r\n    DstIP = iff(SyslogMessage !contains \"Fortigate\", \r\n                extract(\"dst=([\\\\d\\\\.]+):\", 1, SyslogMessage), \r\n                extract(\"dst=([^ ]+)\", 1, SyslogMessage)),\r\n    DstPort = iff(SyslogMessage !contains \"Fortigate\", \r\n                  extract(\"dst=[\\\\d\\\\.]+:(\\\\d+)\", 1, SyslogMessage), \r\n                  extract(\"dpt=([^ ]+)\", 1, SyslogMessage)),\r\n    Protocol = iff(SyslogMessage !contains \"Fortigate\", \r\n                   extract(\"proto=([\\\\w\\\\d]+)\\\\/\", 1, SyslogMessage), \r\n                   extract(\"proto=([^ ]+)\", 1, SyslogMessage)),\r\n    Application = iff(SyslogMessage !contains \"Fortigate\", \r\n                      extract(\"proto=[\\\\w\\\\d]+\\\\/([a-zA-Z]+)\", 1, SyslogMessage), \r\n                      extract(\"app=([^ ]+)\", 1, SyslogMessage)),\r\n    Category = iff(SyslogMessage !contains \"Fortigate\", \r\n                   extract('Category=\\\"([^\\\"]+)\\\"', 1, SyslogMessage), \r\n                   extract(\"cat=([^ ]+)\", 1, SyslogMessage)),\r\n    FirewallAction = iff(SyslogMessage !contains \"Fortigate\", \r\n                         extract('fw_action=\\\"([^\\\"]+)\\\"', 1, SyslogMessage), \r\n                         extract(\"act=([^ ]+)\", 1, SyslogMessage)),\r\n    Code = iff(SyslogMessage !contains \"Fortigate\", \r\n               extract(\"code=(\\\\d+)\", 1, SyslogMessage), \r\n               \"\"), // Placeholder as Code isn't directly in Fortinet log\r\n    URL = iff(SyslogMessage !contains \"Fortigate\", \r\n              \"\", // Placeholder as URL extraction depends on the non-Fortinet log format\r\n              extract(\"request=([^ ]+)\", 1, SyslogMessage))\r\n| extend Pack=pack_all()\r\n| extend TimeFromNow = now() - TimeGenerated\r\n| extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago') \r\n| project [\"Time\"]=strcat('🕒', TimeAgo), TimeGenerated, Firewall = HostName, SeverityLevel, [\"Details\"]=Pack, SrcIP, SrcPort, DstIP, DstPort, Application, FirewallAction, URL, Category\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "SysLog Table",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "rowLimit": 50
              }
            },
            "name": "SysLog Table"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let searchvalue = \"{Variable}\";\r\nDeviceNetworkEvents\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where DeviceName has '{Variable}' and RemoteIPType == \"Public\"\r\n| where RemoteUrl !in (\"\") and (RemoteUrl !contains \"windows\") and (RemoteUrl !contains \"update\") and (RemoteUrl !contains \"office\") and (RemoteUrl !contains \"qarbon\") and (RemoteUrl !contains \"live\") and (RemoteUrl !contains \"microsoft\") and (RemoteUrl !contains \"google\") and (RemoteUrl !contains \"skype\") and (RemoteUrl !contains \"digicert\") and (RemoteUrl !contains \"azure\") and (RemoteUrl !contains \"bing\") and (RemoteUrl !contains \"live\") and (RemoteUrl !contains \"lenovo\") and (RemoteUrl !contains \"adobe\") and (RemoteUrl !contains \"msn\") and (RemoteUrl !contains \"oneclient\") and (RemoteUrl !contains \"gcp\") and (RemoteUrl !contains \"onenote\") and (RemoteUrl !contains \"oracle\") and (RemoteUrl !contains \"paloaltonetworks\") \r\n| summarize ConnectionCount = count() by RemoteIP, RemotePort\r\n| order by ConnectionCount desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Connections to Public IPs- Filtered",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "rowLimit": 5000
              }
            },
            "customWidth": "50",
            "name": "Connections to Public IPs - Filtered"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let searchvalue = \"{Variable}\";\r\nDeviceNetworkEvents\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where DeviceName has '{Variable}' and RemoteIPType == \"Public\"\r\n| where RemoteUrl != \"\"\r\n| where RemoteUrl !in (\"\") and (RemoteUrl !contains \"windows\") and (RemoteUrl !contains \"update\") and (RemoteUrl !contains \"office\") and (RemoteUrl !contains \"qarbon\") and (RemoteUrl !contains \"live\") and (RemoteUrl !contains \"microsoft\") and (RemoteUrl !contains \"google\") and (RemoteUrl !contains \"skype\") and (RemoteUrl !contains \"digicert\") and (RemoteUrl !contains \"azure\") and (RemoteUrl !contains \"bing\") and (RemoteUrl !contains \"live\") and (RemoteUrl !contains \"lenovo\") and (RemoteUrl !contains \"adobe\") and (RemoteUrl !contains \"msn\") and (RemoteUrl !contains \"oneclient\") and (RemoteUrl !contains \"gcp\") and (RemoteUrl !contains \"onenote\") and (RemoteUrl !contains \"oracle\") and (RemoteUrl !contains \"paloaltonetworks\") \r\n| summarize URLCount = count() by RemoteUrl\r\n| order by URLCount desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Top URL Vists - Filtered",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "rowLimit": 5000,
                "filter": true
              }
            },
            "customWidth": "50",
            "name": "Top URL Vists - Filtered"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let HostnameParam = @'{Variable}';\r\nDeviceFileEvents\r\n| where DeviceName contains HostnameParam\r\n| where ActionType == \"FileCreated\"\r\n| where (FileName !contains \"PSScriptPolicyTest\") and (FileName !startswith \"edr\") and (FileName !contains \"autod\") and (FileName != \"Report.wer\")\r\n| where InitiatingProcessAccountName !in (\"himds\", \"network service\", \"system\")\r\n| project TimeGenerated, FileName, FolderPath, FileSize, InitiatingProcessAccountName, InitiatingProcessFolderPath, SHA256\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "File Creation events",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "File Creation Events"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let HostnameParam = '{Variable}';\r\nDeviceInfo\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where DeviceName has HostnameParam\r\n| where LoggedOnUsers <> \"[]\"\r\n| extend UserName = tostring(LoggedOnUsers[0].UserName)\r\n| summarize EventCount = count() by UserName, DeviceName\r\n| order by EventCount desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Common Users via DeviceInfo",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "sortBy": []
            },
            "name": "Common Users via DeviceInfo"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where EventID in (\"1149\", \"21\", \"22\", \"24\", \"40\", \"4779\", \"39\", \"9009\") \r\n    or (EventID in (\"4624\", \"4625\", \"4634\") and LogonType == \"10\")\r\n    and Computer contains @'{Variable}'\r\n| project TimeGenerated, Account, Computer, Activity, IpAddress, ProcessId, SubjectAccount, TargetUserName\r\n| order by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "RDP Activity",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "sortBy": []
            },
            "name": "RDP Activity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let HostnameParam = '{Variable}';\r\nSecurityEvent\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where EventID in (4624, 4625) // 4624 for successful logon, 4625 for logon failure\r\n| where Computer has HostnameParam // Filter events for the specific hostname\r\n| summarize count() by Account, AccountType, LogonType, IpAddress, WorkstationName, Status, EventID, FailureReason\r\n| order by count_ desc",
              "size": 0,
              "showAnalytics": true,
              "title": "SysLog signins to host",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "sortBy": []
            },
            "name": "SysLog signins to host"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let HostnameParam = @'{Variable}';\r\nDeviceProcessEvents\r\n| where DeviceName contains HostnameParam\r\n| project TimeGenerated, AccountName, AccountUpn, FileName, FolderPath, ProcessCommandLine, PID = InitiatingProcessId, MD5 = InitiatingProcessMD5, ParentProcess = InitiatingProcessParentFileName, Product = ProcessVersionInfoProductName\r\n| order by TimeGenerated desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Device Process Events",
              "timeContextFromParameter": "Timerange",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "name": "Device Process Events"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let HostnameParam = @'{Variable}';\r\nDeviceRegistryEvents\r\n| where DeviceName contains HostnameParam\r\n| project TimeGenerated, ActionType, UPN = InitiatingProcessAccountUpn, RegistryKey, PrevValue = PreviousRegistryValueData, PrevValueName = PreviousRegistryValueName, NewValue = RegistryValueData, NewValueName = RegistryValueName, Type = RegistryValueType, File = InitiatingProcessFileName, CommandLine = InitiatingProcessCommandLine\r\n| order by TimeGenerated desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Device Registry Events",
              "timeContextFromParameter": "Timerange",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "name": "Device Registry Events"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let HostnameParam = @'{Variable}';\r\nlet ProcessPath = (InputTable: (Key: string)) {\r\n    InputTable\r\n    | extend Splitted_Key = split(Key, '\\\\')\r\n    | mv-expand idx = range(0, array_length(Splitted_Key) - 1, 1) to typeof(int)\r\n    | extend Paths = iif(idx == 0, Splitted_Key[0], strcat(Splitted_Key[0], '\\\\', strcat_array(array_slice(Splitted_Key, 1, idx), '\\\\')))\r\n    | summarize by Paths\r\n    | extend Node_Order = split(Paths, \"\\\\\")\r\n    | extend Family_Length = array_length(Node_Order)\r\n    | order by Family_Length asc\r\n    | extend Current_Parent_Path = strcat_array(array_slice(Node_Order, 0, -2), \"\\\\\")\r\n    | where Paths != \"\"\r\n    | extend Index = row_number()\r\n    | project Paths, Current_Parent_Path, Index\r\n};\r\nlet paths = DeviceFileEvents\r\n    | where DeviceName == @'{Variable}'\r\n    | distinct FolderPath\r\n    | project Key = FolderPath;\r\nProcessPath(paths)\r\n| join kind=leftouter ProcessPath(paths) on $left.Current_Parent_Path == $right.Paths\r\n| extend Single_Folders = split(Paths, \"\\\\\")[-1]\r\n| project Single_Folders, Child_Index = Index1, Parent_Index = Index\r\n",
              "size": 0,
              "showAnalytics": true,
              "title": "File Structure of Changed Files - DeviceFileEvents",
              "noDataMessage": "DeviceFileEvents does not exist.",
              "timeContextFromParameter": "Timerange",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "showExpandCollapseGrid": true,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Child_Index",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Parent_Index",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "hierarchySettings": {
                  "idColumn": "Parent_Index",
                  "parentColumn": "Child_Index",
                  "treeType": 0,
                  "expanderColumn": "Single_Folders"
                }
              },
              "sortBy": []
            },
            "name": "File Structure of Changed Files "
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "EntityType",
        "comparison": "isEqualTo",
        "value": "host"
      },
      "name": "Host Triage",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Public IP Triage ",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "OfficeActivity\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where ClientIP == '{Variable}'\r\n| lookup kind=leftouter (SigninLogs\r\n    | extend city_ = tostring(LocationDetails.city)\r\n    | extend state_ = tostring(LocationDetails.state)\r\n    | extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion)\r\n    | project SignIn_IPAddress = IPAddress, city_, state_, countryOrRegion_)\r\n  on $left.ClientIP == $right.SignIn_IPAddress\r\n| summarize ActivityCount = count() by UserId, Operation, UserAgent, city_, state_, countryOrRegion_, ClientIP\r\n| order by ActivityCount asc",
              "size": 1,
              "showAnalytics": true,
              "title": "Uncommon Office 365 Activity from IP",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Uncommon Office 365 Activity from IP"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "OfficeActivity\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where ClientIP == '{Variable}'\r\n| lookup kind=leftouter (SigninLogs\r\n    | extend city_ = tostring(LocationDetails.city)\r\n    | extend state_ = tostring(LocationDetails.state)\r\n    | extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion)\r\n    | project SignIn_IPAddress = IPAddress, city_, state_, countryOrRegion_)\r\n  on $left.ClientIP == $right.SignIn_IPAddress\r\n| project TimeGenerated, UserId, Operation, UserAgent, city_, state_, countryOrRegion_, ClientIP\r\n| order by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Recent Office 365 Activity from IP",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Recent Office 365 Activity from IP"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where IPAddress == '{Variable}'\r\n| extend city_ = tostring(LocationDetails.city), \r\n        state_ = tostring(LocationDetails.state), \r\n        countryOrRegion_ = tostring(LocationDetails.countryOrRegion),\r\n        OS = tostring(DeviceDetail.operatingSystem),\r\n        DeviceName = tostring(DeviceDetail.displayName)\r\n| extend DeviceName = tostring(DeviceDetail.displayName)\r\n| summarize Count = count() by ResultType, ResultDescription, city_, state_, countryOrRegion_,\r\n        UserPrincipalName, \r\n        ResourceDisplayName, \r\n        DeviceName,\r\n        OS,\r\n        ConditionalAccessStatus,\r\n        TokenIssuerType\r\n| order by Count desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Common Azure SignIn Activity",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Common Azure SignIn Activity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where IPAddress == '{Variable}'\r\n| extend city_ = tostring(LocationDetails.city), \r\n        state_ = tostring(LocationDetails.state), \r\n        countryOrRegion_ = tostring(LocationDetails.countryOrRegion),\r\n        OS = tostring(DeviceDetail.operatingSystem),\r\n        DeviceName = tostring(DeviceDetail.displayName)\r\n| extend DeviceName = tostring(DeviceDetail.displayName)\r\n| project TimeGenerated, ResultType, ResultDescription, city_, state_, countryOrRegion_,\r\n        UserPrincipalName, \r\n        ResourceDisplayName, \r\n        DeviceName,\r\n        OS,\r\n        ConditionalAccessStatus,\r\n        TokenIssuerType\r\n| order by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Recent Azure SignIn Activity",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Recent Azure SignIn Activity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AzureActivity\r\n| search \"{Variable}\"\r\n| extend ActionPath = tostring(parse_json(Properties).message)\r\n| extend SourceResource = tostring(parse_json(Properties).resource)\r\n| extend AuthroizedRole = tostring(parse_json(tostring(parse_json(Authorization).evidence)).role)\r\n| project TimeGenerated, CallerIpAddress, ActivityStatusValue, ResourceGroup, ActionPath, SourceResource, AuthroizedRole\r\n| order by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "AzureActivity from IP",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Azure Activity from IP"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| search @'{Variable}'\r\n| where EventID in (\"1149\", \"21\", \"22\", \"24\", \"40\", \"4779\", \"39\", \"9009\") \r\n    or (EventID in (\"4624\", \"4625\", \"4634\") and LogonType == \"10\")\r\n| project TimeGenerated, Account, Computer, Activity, IpAddress, ProcessId, SubjectAccount, TargetUserName\r\n| order by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "RDP Activity",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "RDP Activity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let searchvalue = \"{Variable}\";\r\nThreatIntelligenceIndicator\r\n| where isnotempty(searchvalue)\r\n| where NetworkIP contains_cs \"{Variable}\"\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "IP Threat Intelligence Lookup",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "IP Threat Intelligence Lookup"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"SigninLogs\\r\\n| where IPAddress == \\\"{Variable}\\\"\\r\\n| extend Geo = parse_json(tostring(parse_json(LocationDetails)['geoCoordinates']))\\r\\n| extend Latitude = toreal((tostring(parse_json(Geo)['latitude'])))\\r\\n| extend Longitude = toreal(parse_json(tostring(parse_json(Geo)['longitude'])))\\r\\n| summarize Count = count() by Longitude, Latitude, IPAddress\\r\\n| project Longitude, Latitude, Count, IPAddress\\r\\n| render scatterchart with (kind=map)\",\"clusterName\":\"ibwcsoc2131cluster.southcentralus\",\"databaseName\":\"M2131\"}",
              "size": 3,
              "showAnalytics": true,
              "title": "IP Location - PublicIP",
              "showExportToExcel": true,
              "queryType": 9,
              "visualization": "map",
              "mapSettings": {
                "locInfo": "LatLong",
                "latitude": "Latitude",
                "longitude": "Longitude",
                "sizeSettings": "Longitude",
                "sizeAggregation": "Sum",
                "legendMetric": "Longitude",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "Longitude",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "name": "IP Location - PublicIP (IBWC ONLY)",
            "styleSettings": {
              "showBorder": true
            }
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "EntityType",
        "comparison": "isEqualTo",
        "value": "publicip"
      },
      "name": "Public IP Triage ",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let ip_address = '{Variable}';\r\n// Collecting security events related to the IP address within the specified time range\r\nSecurityEvent\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where IpAddress == ip_address\r\n| where EventID in (4624, // An account was successfully logged on\r\n                    4625, // An account failed to log on\r\n                    4648, // A logon was attempted using explicit credentials\r\n                    4672) // Special privileges assigned to new logon\r\n| summarize Count = count() by Account, Computer, EventID, Activity, LogonType\r\n| order by Count desc",
        "size": 0,
        "showAnalytics": true,
        "title": "Common Syslog Logon Events - PrivateIP",
        "timeContextFromParameter": "Timerange",
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ]
      },
      "conditionalVisibility": {
        "parameterName": "EntityType",
        "comparison": "isEqualTo",
        "value": "privateip"
      },
      "name": "Common Syslog Logon Events - PrivateIP"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Private IP Triage",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let ip_address = '{Variable}';\r\nSecurityEvent\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where EventID == 4624 // An account was successfully logged on\r\n| where IpAddress == ip_address\r\n| summarize HostLogonCount = count() by Computer\r\n| order by HostLogonCount desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Most Common Hosts - Windows Events",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Computer",
                  "formatter": 10,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "leftContent": {
                  "columnMatch": "HostLogonCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "Computer",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "HostLogonCount",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "mapSettings": {
                "locInfo": "LatLong",
                "sizeSettings": "HostLogonCount",
                "sizeAggregation": "Sum",
                "legendMetric": "HostLogonCount",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "type": "heatmap",
                  "colorAggregation": "Sum",
                  "nodeColorField": "HostLogonCount",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "45",
            "name": "Most Common Hosts - Windows Events",
            "styleSettings": {
              "maxWidth": "50"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let ip_address = '{Variable}';\r\nSecurityEvent\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where EventID == 4624 // An account was successfully logged on\r\n| where IpAddress == ip_address\r\n| summarize UserHostLogonCount = count() by TargetUserName, Computer\r\n| top 5 by UserHostLogonCount desc",
              "size": 1,
              "showAnalytics": true,
              "title": " Users Logged Into Specific Hosts - Windows Events",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "customWidth": "45",
            "name": " Users Logged Into Specific Hosts - Windows Events",
            "styleSettings": {
              "maxWidth": "50"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let DeviceNameFromIP = Heartbeat\r\n| where ComputerPrivateIPs has \"{Variable}\" \r\n| extend DeviceName = tostring(split(Computer, \".\")[0])\r\n| summarize by DeviceName; \r\nSigninLogs\r\n| where ResultType == \"0\"\r\n| extend DeviceName = tostring(DeviceDetail.displayName)\r\n| join kind=inner DeviceNameFromIP on DeviceName \r\n| extend city_ = tostring(LocationDetails.city)\r\n| extend state_ = tostring(LocationDetails.state)\r\n| extend countryOrRegion_ = tostring(LocationDetails.countryOrRegion)\r\n| extend fullLocation = strcat(\r\n    iff(isempty(city_), '', strcat(city_, ', ')), \r\n    iff(isempty(state_), '', strcat(state_, ', ')), \r\n    countryOrRegion_)\r\n| project TimeGenerated, DeviceName, UserPrincipalName, UserDisplayName, fullLocation, AppDisplayName, IPAddress, UserAgent",
              "size": 1,
              "showAnalytics": true,
              "title": "SignInLogs Events from Associated Host",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "SignInLogs Events from Associated Host"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Heartbeat\r\n| where ComputerPrivateIPs contains \"{Variable}\"\r\n| project TimeGenerated, Computer, ComputerIP, OSType, OSName, RemoteIPCountry, ComputerPrivateIPs, ComputerEnvironment\r\n| take 1",
              "size": 3,
              "showAnalytics": true,
              "title": "Heartbeat Device Info",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Heartbeat Device Info"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let ip_address = '{Variable}';\r\nDeviceNetworkEvents\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| where LocalIP == ip_address or RemoteIP == ip_address\r\n//| where ActionType !contains \"inspected\"\r\n| extend Protocol = case(\r\n    ActionType contains \"HTTP\", \"HTTP\",\r\n    ActionType contains \"Https\", \"HTTPS\",\r\n    ActionType contains \"DNS\", \"DNS\",\r\n    ActionType contains \"ssh\", \"SSH\",\r\n    ActionType contains \"rdp\", \"RDP\",\r\n    ActionType contains \"ftp\", \"FTP\",\r\n    \"Other\"\r\n)\r\n| project-reorder TimeGenerated, \r\n          LocalIP, \r\n          RemoteIP, \r\n          Protocol, \r\n          ActionType,\r\n          LocalPort, \r\n          RemotePort, \r\n          InitiatingProcessCommandLine\r\n| order by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Host Network Connections",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Host Network Connections"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where EventID in (\"1149\", \"21\", \"22\", \"24\", \"40\", \"4779\", \"39\", \"9009\") \r\n    or (EventID in (\"4624\", \"4625\", \"4634\") and LogonType == \"10\")\r\n    and IpAddress == \"{Variable}\"\r\n| project TimeGenerated, Account, Computer, Activity, IpAddress, ProcessId, SubjectAccount, TargetUserName",
              "size": 1,
              "showAnalytics": true,
              "title": "RDP Activity",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "RDP Activity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let ip_address = '{Variable}';\r\nSyslog\r\n| extend \r\n//    SerialNumber = extract(\"sn=([\\\\w\\\\d]+)\", 1, SyslogMessage),\r\n//    Firewall = extract(\"fw=([\\\\d\\\\.]+)\", 1, SyslogMessage),\r\n//    Priority = extract(\"pri=(\\\\d+)\", 1, SyslogMessage),\r\n    Message = extract(\"msg=\\\"([^\\\"]+)\\\"\", 1, SyslogMessage),\r\n//    SrcMac = extract(\"srcMac=([\\\\w\\\\d:]+)\", 1, SyslogMessage),\r\n    SrcIP = extract(\"src=([\\\\d\\\\.]+):\", 1, SyslogMessage),\r\n    SrcPort = extract(\"src=[\\\\d\\\\.]+:(\\\\d+)\", 1, SyslogMessage),\r\n//    NatSrc = extract(\"natSrc=([\\\\d\\\\.]+)\", 1, SyslogMessage),\r\n//    DstMac = extract(\"dstMac=([\\\\w\\\\d:]+)\", 1, SyslogMessage),\r\n    DstIP = extract(\"dst=([\\\\d\\\\.]+):\", 1, SyslogMessage),\r\n    DstPort = extract(\"dst=[\\\\d\\\\.]+:(\\\\d+)\", 1, SyslogMessage),\r\n    Protocol = extract(\"proto=([\\\\w\\\\d]+)\\\\/\", 1, SyslogMessage),\r\n    Application = extract(\"proto=[\\\\w\\\\d]+\\\\/([a-zA-Z]+)\", 1, SyslogMessage),\r\n    Category = extract(\"Category=\\\"([^\\\"]+)\\\"\", 1, SyslogMessage),\r\n    FirewallAction = extract(\"fw_action=\\\"([^\\\"]+)\\\"\", 1, SyslogMessage)\r\n //   Code = extract(\"code=(\\\\d+)\", 1, SyslogMessage)\r\n| where SrcIP == ip_address or DstIP == ip_address \r\n| project TimeGenerated, Message, SrcIP, SrcPort, DstIP, DstPort, Protocol, Application, Category, FirewallAction\r\n| order by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Syslog FW Connection Events",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "Syslog FW Connection Events"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "EntityType",
        "comparison": "isEqualTo",
        "value": "ip"
      },
      "name": "Private IP Triage",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "AD User Triage",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| search @'{Variable}'\r\n| project-away $table, TenantId, SourceSystem, EventSourceName, Channel, Task, Level, EventData\r\n| order by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "SecurityEvent Table",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "SecurityEvent Table"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where Account contains @'{Variable}'\r\n| where EventID in (4727, 4728, 4729, 4730, 4731, 4732, 4733, 4734, 4735, 4737, 4754, 4755, 4756, 4757, 4758, 4759)\r\n| project TimeGenerated, Computer, TargetUserName, SubjectUserName, MemberSid\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Security Group Management",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Security Group Management"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where Account contains @'{Variable}'\r\n| where EventID in (4720, 4722, 4725, 4726, 4738)\r\n| project TimeGenerated, Computer, TargetUserName, SubjectUserName, Activity\r\n| order by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "User Account Changes (Creation, Deletion, Modification)",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "User Account Changes (Creation, Deletion, Modification)"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where Account contains @'{Variable}'\r\n| where EventID == 4688 and NewProcessName contains \"powershell\"\r\n| project-reorder TimeGenerated, Computer, CommandLine",
              "size": 1,
              "showAnalytics": true,
              "title": "Powershell usage",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Powershell usage"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where Account contains @'{Variable}'\r\n| where EventID in (\"1149\", \"21\", \"22\", \"24\", \"40\", \"4779\", \"39\", \"9009\") \r\n    or (EventID in (\"4624\", \"4625\", \"4634\") and LogonType == \"10\")\r\n| project TimeGenerated, Account, Computer, Activity, IpAddress, ProcessId, SubjectAccount, TargetUserName\r\n| order by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "RDP Activity",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "RDP Activity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let suspiciousAccount = @'{Variable}';\r\nlet AllEvents = SecurityEvent\r\n    | where Account contains suspiciousAccount and EventID in (4624, 4634, 4672)\r\n    | where LogonType in (\"2\", \"10\", \"11\", \"12\")\r\n    | extend LogonId = coalesce(TargetLogonId, SubjectLogonId)\r\n    | join kind=leftouter (\r\n        SecurityEvent\r\n        | where EventID == \"4672\"\r\n        | project EventID, LogonId = SubjectLogonId\r\n    ) on LogonId\r\n    | extend EventType = case(EventID1 == 4672, \"SpecialLogon\", EventID == 4624, \"Logon\", EventID == 4634, \"Logoff\", \"Other\")\r\n    | project TimeGenerated, Account, LogonId, EventType, Computer, LogonType;\r\nAllEvents\r\n| summarize\r\n    MinTime=min(TimeGenerated),\r\n    MaxTime=max(TimeGenerated),\r\n    SpecialLogonOccurred=any(EventType == \"SpecialLogon\")\r\n    by LogonId, Account, Computer, LogonType\r\n| extend SessionLengthSeconds = datetime_diff('second', MaxTime, MinTime)\r\n| extend Days = toint(SessionLengthSeconds / 86400)\r\n| extend Hours = toint((SessionLengthSeconds % 86400) / 3600)\r\n| extend Minutes = toint((SessionLengthSeconds % 3600) / 60)\r\n| extend Seconds = SessionLengthSeconds % 60\r\n| extend SessionLengthFormatted = strcat(\r\n                                      tostring(Days),\r\n                                      \"d:\",\r\n                                      iff(Hours < 10, strcat(\"0\", tostring(Hours)), tostring(Hours)),\r\n                                      \"h:\",\r\n                                      iff(Minutes < 10, strcat(\"0\", tostring(Minutes)), tostring(Minutes)),\r\n                                      \"m:\",\r\n                                      iff(Seconds < 10, strcat(\"0\", tostring(Seconds)), tostring(Seconds)),\r\n                                      \"s\"\r\n                                  )\r\n| where SessionLengthSeconds > 1 // Filter out any short sessions\r\n| project\r\n    Account,\r\n    SessionStart = MinTime,\r\n    SessionEnd = MaxTime,\r\n    SessionLengthFormatted,\r\n    SpecialLogonOccurred,\r\n    Computer,\r\n    LogonType,\r\n    LogonId",
              "size": 1,
              "showAnalytics": true,
              "title": "Windows Event User Sessions",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Windows Event User Sessions"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where Account contains @'{Variable}'\r\n| where EventID in (\"4624\")\r\n| project TimeGenerated, Account, IpAddress, LogonTypeName, Computer, Activity\r\n| join kind=inner (\r\n    Heartbeat\r\n    | extend IpAddress = tostring(ComputerPrivateIPs[0])\r\n    | project OSName, ComputerEnvironment, IpAddress\r\n) on IpAddress\r\n| project-away IpAddress1\r\n| summarize Count = count() by Computer, IpAddress, Account\r\n| order by Count desc \r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Unique Hosts Successfully Logged Into",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Unique Hosts Successfully Logged Into"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where Account contains @'{Variable}'\r\n| where EventID in (\"4625\", \"4771\", \"4776\")\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Failed Logon Activity",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Failed Logon Activity - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where Account contains @'{Variable}'\r\n| where EventID == \"4624\"\r\n| project TimeGenerated, IpAddress, LogonType, Computer\r\n| join kind=leftouter (\r\n    Heartbeat\r\n    | extend IpAddress = tostring(ComputerPrivateIPs[0])\r\n    | project OSName, ComputerEnvironment, IpAddress\r\n) on IpAddress\r\n| project-away IpAddress1",
              "size": 1,
              "showAnalytics": true,
              "title": "Successful Logon Activity",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "Successful Logon Activity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\r\n| where TargetAccount contains @'{Variable}'\r\n| where EventID in (\"4723\", \"4724\")\r\n| project TimeGenerated, SourceAccount = Account, Computer, TargetAccount, Activity",
              "size": 4,
              "showAnalytics": true,
              "title": "Windows Password Resets",
              "timeContextFromParameter": "Timerange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "name": "Windows Password Resets"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "EntityType",
        "comparison": "isEqualTo",
        "value": "aduser"
      },
      "name": "AD User Triage",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "union *\r\n| search @\"{Variable}\" \r\n| summarize  count1 = count() by Type\r\n| order by count1 desc",
        "size": 3,
        "showAnalytics": true,
        "title": "Events per Table",
        "color": "green",
        "timeContextFromParameter": "Timerange",
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Type",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count1",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          },
          "showBorder": false
        },
        "chartSettings": {
          "customThresholdLineStyle": 3
        }
      },
      "name": "Events per Table",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let TimeInterval = 1h; // Adjust the time interval as necessary\r\nunion *\r\n| where TimeGenerated between ({Timerange:start} .. {Timerange:end})\r\n| search @'{Variable}'\r\n| summarize Count = count() by bin(TimeGenerated, TimeInterval)\r\n| union (\r\n    range TimeGenerated from {Timerange:start} to {Timerange:end} step TimeInterval\r\n    | extend Count = 0 // This creates the zero-value rows for dates without any logs\r\n)\r\n| summarize EventCount = sum(Count) by bin(TimeGenerated, TimeInterval)\r\n| render timechart",
        "size": 0,
        "showAnalytics": true,
        "title": "Log Source Count - 1 Hour Increments",
        "color": "green",
        "timeContextFromParameter": "Timerange",
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "timechart",
        "chartSettings": {
          "customThresholdLineStyle": 3
        }
      },
      "customWidth": "50",
      "name": "Log Source Count - 1 Hour Increments",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityEvent\r\n| where TimeGenerated >= {Timerange:start} and TimeGenerated <= {Timerange:end}\r\n| search @\"{Variable}\" \r\n| summarize count() by EventID, Activity",
        "size": 0,
        "showAnalytics": true,
        "title": "Windows Event Log Graph",
        "timeContextFromParameter": "Timerange",
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "graph",
        "gridSettings": {
          "filter": true
        },
        "graphSettings": {
          "type": 2,
          "topContent": {
            "columnMatch": "EventID",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "count_",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          },
          "bottomContent": {
            "columnMatch": "Activity"
          },
          "nodeIdField": "count_",
          "graphOrientation": 3,
          "showOrientationToggles": false,
          "nodeSize": null,
          "staticNodeSize": 100,
          "colorSettings": null,
          "hivesMargin": 5,
          "edgeColorSettings": null
        }
      },
      "customWidth": "50",
      "name": "Windows Event Log Graph",
      "styleSettings": {
        "showBorder": true
      }
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/193adb00-3bae-469e-b548-830a894810a0/resourcegroups/quzara-monitoring/providers/microsoft.operationalinsights/workspaces/quzara-corporate"
  ],
  "fromTemplateId": "sentinel-UserWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
